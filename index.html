<!DOCTYPE html>
<html lang="en">
<head>
  <title>ğŸ’— Serenity now... Insanity later</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <link href="css/style.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet">
</head>
<body>
  <div id="digital-clock">00:00:00</div>
  <div id="weather-btn">â›…</div>
  <div id="weather-info">
    <div id="weather-current">Loading current weather...</div>
    <hr>
    <div id="weather-hourly"><strong>Hourly Forecast</strong><br>Loading...</div>
    <hr>
    <div id="weather-daily"><strong>Daily Forecast</strong><br>Loading...</div>
  </div>
  <div class="webgl"></div>
  <div class="over">
    <img src="hoot.png" alt="Hoot" style="position: fixed; bottom: 10px; left: 10px; width: 50px; height: auto; opacity: 0.9; z-index: 9999; pointer-events: none;" />
    <h1>serenity now</h1>
    <div id="emoji-target"></div>
    <div class="btn-container">
      <div class="big-btn">Seriously?</div>
    </div>
  </div>

  <!-- Combined Script Imports on One Line -->
  <script src="lib/three.min.js"></script><script src="lib/stats.min.js"></script><script src="lib/SimplexNoise.js"></script><script src="lib/minivents.min.js"></script><script src="lib/TweenMax.min.js"></script><script src="lib/OrbitControls.js"></script><script src="lib/dat.gui.min.js"></script><script src="lib/atutil.js"></script><script src="lib/seedrandom.js"></script><script src="lib/three/postprocessing/EffectComposer.js"></script><script src="lib/three/postprocessing/RenderPass.js"></script><script src="lib/three/postprocessing/MaskPass.js"></script><script src="lib/three/postprocessing/ShaderPass.js"></script><script src="lib/three/shaders/FXAAShader.js"></script><script src="lib/three/shaders/CopyShader.js"></script><script src="lib/three/shaders/VignetteShader.js"></script><script src="js/SuperShader.js"></script><script src="js/TiltShiftShader.js"></script><script src="js/NoiseShader.js"></script><script src="js/SpaceShader.js"></script><script src="js/CustomRGBShiftShader.js"></script><script src="js/StarShader.js"></script><script src="js/Stars.js"></script><script src="js/Confetti.js"></script><script src="js/Ribbon.js"></script><script src="js/main.js"></script>

  <!-- UI Text & Clock -->
  <script>
    const messages = ["What","Why","Now","Really","Again","Seriously","Wait","Huh","Uh...","Nope","This?","That?","How","Who","Where","When","Which","Maybe","Oops","Bruh","Yo","Help","Pls","IDK","Hm","Wut","Meh","Ehh","Sigh","Fine","Ok","lol","what even","is this","donâ€™t","not again","stop","more?","why tho"];
    const punctuations = ["?","!","...","?!","!?","??","â€½"];
    const btn = document.querySelector(".big-btn");
    if (btn) {
      const message = messages[Math.floor(Math.random() * messages.length)];
      const punct = punctuations[Math.floor(Math.random() * punctuations.length)];
      btn.textContent = message + punct;
    }

    function getRandomEmoji() {
      const ranges = [[0x1F600,0x1F64F],[0x1F300,0x1F5FF],[0x1F680,0x1F6FF],[0x2600,0x26FF],[0x2700,0x27BF]];
      const range = ranges[Math.floor(Math.random() * ranges.length)];
      const codePoint = Math.floor(Math.random() * (range[1] - range[0] + 1)) + range[0];
      return String.fromCodePoint(codePoint);
    }

    function getRandomEmojis(count = 4) {
      let emojis = '';
      for (let i = 0; i < count; i++) emojis += getRandomEmoji() + ' ';
      return emojis.trim();
    }

    window.addEventListener('DOMContentLoaded', () => {
      const p = document.getElementById('emoji-target');
      const emojis = getRandomEmojis(4);
      p.textContent = `${emojis} insanity later`;
    });

    function updateClock() {
      const now = new Date();
      let hours = now.getHours();
      const minutes = now.getMinutes().toString().padStart(2, '0');
      const seconds = now.getSeconds().toString().padStart(2, '0');
      hours = hours % 12 || 12;
      const timeString = `${hours}:${minutes}:${seconds}`;
      document.getElementById('digital-clock').textContent = timeString;
    }

    setInterval(updateClock, 1000);
    updateClock();

    window.addEventListener("load", () => {
      setTimeout(() => {
        document.querySelector(".over").style.display = "none";
        document.getElementById("weather-btn").style.display = "none";
      }, 60000);
    });

    function updateTitleClock() {
      const now = new Date();
      let hours = now.getHours() % 12 || 12;
      const minutes = now.getMinutes().toString().padStart(2, '0');
      const timeString = `${hours}:${minutes}`;
      const originalTitle = document.title.replace(/^\d{1,2}:\d{2} /, '');
      document.title = `${timeString} ${originalTitle}`;
    }

    setInterval(updateTitleClock, 30000);
    updateTitleClock();
  </script>

  <!-- Weather Script (Accurate hourly forecast fix) -->
  <script>
    const weatherBtn = document.getElementById('weather-btn');
    const weatherCodeToEmoji = {
      0:"â˜€ï¸",1:"ğŸŒ¤ï¸",2:"â›…",3:"â˜ï¸",45:"ğŸŒ«ï¸",48:"ğŸŒ«ï¸",
      51:"ğŸŒ¦ï¸",53:"ğŸŒ¦ï¸",55:"ğŸŒ§ï¸",56:"ğŸŒ§ï¸",57:"ğŸŒ§ï¸",
      61:"ğŸŒ¦ï¸",63:"ğŸŒ§ï¸",65:"ğŸŒ§ï¸",66:"ğŸŒ§ï¸",67:"ğŸŒ§ï¸",
      71:"â„ï¸",73:"â„ï¸",75:"â„ï¸",77:"ğŸŒ¨ï¸",80:"ğŸŒ§ï¸",
      81:"ğŸŒ§ï¸",82:"ğŸŒ§ï¸",85:"â„ï¸",86:"â„ï¸",95:"â›ˆï¸",
      96:"â›ˆï¸",99:"â›ˆï¸"
    };

    async function getWeather(lat, lon) {
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&temperature_unit=fahrenheit&windspeed_unit=mph&hourly=temperature_2m,weathercode&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=auto`;
      try {
        const res = await fetch(url);
        const data = await res.json();

        // Current Weather
        const current = data.current_weather;
        const currentEmoji = weatherCodeToEmoji[current.weathercode] || "â“";
        weatherBtn.textContent = currentEmoji;
        document.getElementById('weather-current').innerHTML = `${currentEmoji} <strong>${current.temperature.toFixed(1)}Â°F</strong><br>ğŸ’¨ Wind: ${current.windspeed.toFixed(1)} mph<br>ğŸ§­ Direction: ${current.winddirection}Â°`;

        // Hourly Forecast â€” NEXT 6 HOURS based on local time
        const hourlyHTML = [];
        const now = new Date();
        for (let i = 0, count = 0; i < data.hourly.time.length && count < 6; i++) {
          const time = new Date(data.hourly.time[i]);
          if (time > now) {
            const timeStr = time.toLocaleTimeString([], { hour: 'numeric', hour12: true });
            const temp = data.hourly.temperature_2m[i];
            const code = data.hourly.weathercode[i];
            const emoji = weatherCodeToEmoji[code] || "â“";
            hourlyHTML.push(`${timeStr}: ${emoji} ${temp.toFixed(1)}Â°F`);
            count++;
          }
        }
        document.getElementById('weather-hourly').innerHTML = `<strong>Next 6 Hours</strong><br>${hourlyHTML.join('<br>')}`;

        // Daily Forecast (Next 3 Days)
        const dailyHTML = [];
        for (let i = 0; i < 3; i++) {
          const date = new Date(data.daily.time[i]).toLocaleDateString(undefined, { weekday: 'short' });
          const tMin = data.daily.temperature_2m_min[i];
          const tMax = data.daily.temperature_2m_max[i];
          const code = data.daily.weathercode[i];
          const emoji = weatherCodeToEmoji[code] || "â“";
          dailyHTML.push(`${date}: ${emoji} ${Math.round(tMin)}â€“${Math.round(tMax)}Â°F`);
        }
        document.getElementById('weather-daily').innerHTML = `<strong>Next 3 Days</strong><br>${dailyHTML.join('<br>')}`;
      } catch (err) {
        console.error(err);
        document.getElementById('weather-current').textContent = 'âš ï¸ Failed to get weather.';
      }
    }

    function fetchAndStoreLocation() {
      document.getElementById('weather-current').textContent = 'Requesting location...';
      navigator.geolocation.getCurrentPosition((position) => {
        const { latitude, longitude } = position.coords;
        localStorage.setItem("weather_lat", latitude);
        localStorage.setItem("weather_lon", longitude);
        getWeather(latitude, longitude);
      }, (error) => {
        console.error(error);
        document.getElementById('weather-current').textContent = 'âŒ Geolocation error.';
      });
    }

    weatherBtn.addEventListener('click', () => {
      document.getElementById('weather-info').style.display = 'block';
      const lat = localStorage.getItem("weather_lat");
      const lon = localStorage.getItem("weather_lon");
      if (lat && lon) getWeather(lat, lon);
      else fetchAndStoreLocation();
    });
  </script>

  <!-- Minimal inline CSS -->
  <style>
    #digital-clock { display: none; position: fixed; top: 10px; right: 10px; background: black; color: white; font-family: 'Pacifico', monospace; font-size: 14px; padding: 5px 10px; border-radius: 5px; z-index: 9999; pointer-events: none; }
    #weather-btn { position: fixed; bottom: 20px; right: 20px; font-size: 2em; cursor: pointer; z-index: 1000; }
    #weather-info { position: fixed; bottom: 60px; right: 20px; background: white; padding: 10px; border: 1px solid #ccc; border-radius: 8px; display: none; font-family: sans-serif; font-size: 0.9em; z-index: 1000; max-width: 250px; }
    #weather-info hr { border: none; border-top: 1px solid #ccc; margin: 6px 0; }
  </style>
</body>
</html>
